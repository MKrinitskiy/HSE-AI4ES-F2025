# Разведочный анализ данных



### Шаг 1. Первичный осмотр и обзор данных

**(a) Введение.**
 В этом задании предлагается получить высокоуровневое представление о наборе данных: размеры, список переменных и их типы, временной охват и частота измерений. Для временных рядов важно удостовериться, что временная метка корректно распознана, а интервалы регулярны. Для многоточечных наблюдений (несколько станций/буёв) полезно понять, как данные организованы по локациям, и сколько уникальных точек наблюдений присутствует. Такой обзор позволяет рано обнаружить очевидные проблемы (целые столбцы из пропусков, неверные типы, неверно распознанные даты).

**(b) Предлагаемый подход.**

- Использовать `df.shape`, чтобы увидеть количество строк и столбцов.
- Применить `df.columns` и `df.dtypes`, чтобы просмотреть список переменных и их типы.
- Просмотреть первые и последние строки с помощью `df.head()` и `df.tail()` для проверки корректности формата.
- Получить сводную информацию по данным с помощью `df.info()`, включая количество ненулевых значений и типы данных.
- Проверить, что столбец с датой загружен как `datetime`; при необходимости преобразовать его с помощью `pd.to_datetime`.
- Вывести минимальное и максимальное значения времени (`df['date'].min()`, `df['date'].max()`) и убедиться в регулярности интервалов.
- Для многоточечных данных — посчитать количество уникальных станций (`df['station'].nunique()`) и вывести их список (`df['station'].unique()`).

**(c) Ожидаемый результат.**
 Краткое описание состава набора: период наблюдений, дискретность, число переменных и их типы, наличие пространственного измерения (количество станций/буёв). Выявлены ранние «красные флаги» — например, столбцы с множеством пропусков, неверные типы данных, неверно распознанные временные метки.

------

### Шаг 2. Очистка данных: пропуски и выбросы

**(a) Введение.**
 Реальные геофизические наблюдения обычно содержат пропуски (неисправности приборов, простои) и выбросы (ошибки датчиков, редкие экстремальные события). До анализа и моделирования необходимо оценить масштаб пропусков, их структуру во времени и по переменным, а также выделить аномальные значения. Для задач регрессии и прогнозирования непродуманный учет пропусков/выбросов приводит к смещению оценок и ошибкам моделей.

**(b) Предлагаемый подход.**

- Использовать `df.isnull().sum()`, чтобы подсчитать количество пропусков по каждому столбцу.
- Построить временные графики пропусков (например, через маску `df.isnull()` и суммирование по времени), чтобы понять, случайны ли пропуски или сгруппированы.
- Проверить наличие специальных кодов пропусков (например, `-999`, `.`), заменив их на `NaN` с помощью `df.replace()`.
- Для выбросов применить `df.describe()` и сравнить значения с физически реалистичными пределами.
- Построить гистограммы (`df.hist()`) и коробчатые диаграммы (`sns.boxplot`) для поиска экстремальных значений.
- Построить графики временных рядов (`df.plot()`) для ключевых переменных, чтобы выявить резкие скачки.
- Отметить найденные выбросы и принять решение об их дальнейшем обращении (например, удалить через `df.drop()` или заменить с помощью `clip()` или `fillna()`).

**(c) Ожидаемый результат.**
 Список переменных и периодов с пропусками (с долями/количествами), описание их структуры. Перечень обнаруженных выбросов/аномалий с принятой тактикой обработки. Полученная очищенная или аннотированная версия данных, пригодная для дальнейшего анализа.

------

### Шаг 3. Описательная статистика и распределения

**(a) Введение.**
 Описательная статистика и анализ распределений помогают понять диапазоны и вариабельность переменных, наличие асимметрии, мультимодальности, «тяжёлых хвостов». Для природных данных это особенно важно (например, осадки часто имеют нулевую массу и редкие большие значения; ветер — длинный правый хвост). Эти свойства влияют на выбор трансформаций и методов в последующих моделях.

**(b) Предлагаемый подход.**

- Рассчитать статистики с помощью `df.describe()`.
- Для медианы использовать `df.median()`, для произвольных квантилей — `df.quantile([0.25, 0.75])`.
- Построить гистограммы (`df.hist()` или `sns.histplot`) для оценки формы распределений.
- Построить коробчатые диаграммы (`sns.boxplot`) для выявления разброса и выбросов.
- Сравнить средние и медианные значения, чтобы выявить перекосы распределений.
- При необходимости построить распределения по отдельным сезонам или месяцам, добавив столбец `df['month'] = df['date'].dt.month` и группируя данные (`df.groupby('month').mean()`).

**(c) Ожидаемый результат.**
 Таблица с описательной статистикой и графики распределений. Определены переменные с сильной асимметрией, мультимодальностью или узким диапазоном. Сформировано понимание, какие переменные могут требовать трансформаций (например, логарифмирование) перед использованием в моделях.

------

### Шаг 4. Анализ временной структуры: тренды и сезонность

**(a) Введение.**
 Временные ряды геофизики обычно содержат выраженную сезонность (суточную, годовую) и возможные тренды. Выявление этих паттернов необходимо для прогнозирования и корректной спецификации моделей (сезонные признаки, детрендирование, сглаживание).

**(b) Предлагаемый подход.**

- Построить графики временных рядов с помощью `df.plot(x='date', y='variable')`.
- Для трендов — агрегировать данные по более крупным интервалам (`df.resample('M').mean()` для месяцев, `df.resample('Y').mean()` для лет).
- Построить скользящее среднее с помощью `df['var'].rolling(window=30).mean()`.
- Для сезонности — создать признаки `month`, `dayofyear`, `hour` из временного индекса и построить средние значения по этим группам (`df.groupby('month')['var'].mean()`).
- Построить месячные боксплоты (`sns.boxplot(x='month', y='var', data=df)`), чтобы увидеть сезонный диапазон.
- Для выявления необычных периодов построить тепловые карты (например, сводные таблицы `pd.pivot_table` с месяцами и годами).

**(c) Ожидаемый результат.**
 Визуализации с выявленными сезонными циклами и возможными трендами. Определение периодов с устойчивыми отклонениями или аномальным поведением. Получены сезонные профили переменных, пригодные для использования в моделях.

------

### Шаг 5. Взаимосвязи между переменными (корреляции и многомерный анализ)

**(a) Введение.**
 Понимание связей между переменными помогает выявлять предикторы, обнаруживать мультиколлинеарность, проверять физические гипотезы. Для задач регрессии знание корреляций помогает выбрать признаки.

**(b) Предлагаемый подход.**

- Рассчитать корреляционную матрицу `df.corr()` и визуализировать её через `sns.heatmap`.
- Для пар переменных построить диаграммы рассеяния (`sns.scatterplot`).
- При большом числе переменных использовать `sns.pairplot` для поднабора столбцов.
- Для категориальных переменных — построить боксплоты (`sns.boxplot(x='category', y='var')`) и посчитать групповые средние (`df.groupby('category')['var'].mean()`).
- Оценить наличие мультиколлинеарности (например, сильные корреляции >0.9) и зафиксировать возможные избыточные переменные.

**(c) Ожидаемый результат.**
 Набор корреляций и графиков рассеяния с выявленными связями между переменными. Отмечены пары с высокой мультиколлинеарностью, кандидаты для исключения или объединения.

------

### Шаг 6. Дополнительные (опциональные) задания

**(i) Автокорреляция и лаг-анализ временных рядов**
 **(a) Введение.** Геофизические ряды часто автокоррелированы: текущие значения зависят от предыдущих. Это влияет на построение признаков и выбор моделей.
 **(b) Предлагаемый подход.** Построить ACF/PACF с помощью `statsmodels.graphics.tsaplots.plot_acf` и `plot_pacf`. Определить лаги, на которых корреляция сохраняется.
 **(c) Ожидаемый результат.** Список лагов и окон (например, 1, 7, 30 дней) для создания новых признаков.

**(ii) Трансформации и инженерия признаков**
 **(a) Введение.** Выявленные перекосы и сезонность подсказывают полезные преобразования.
 **(b) Предлагаемый подход.** Проверить логарифмирование (`np.log1p`) для сильно скошенных распределений. Добавить сезонные признаки (месяц, день года) или синус/косинус преобразования (`np.sin(2π·t/365)`, `np.cos(2π·t/365)`). Создать скользящие статистики через `rolling()` и `expanding()`.
 **(c) Ожидаемый результат.** Дополнительные признаки, улучшающие модельное описание данных.

**(iii) Геопространственная визуализация (для многоточечных данных)**
 **(a) Введение.** Пространственные различия помогают интерпретации и объяснению.
 **(b) Предлагаемый подход.** Построить карту точек с помощью `matplotlib`, `cartopy` или `geopandas`. Для каждой станции вычислить среднее по переменной и отразить цветом/размером маркера.
 **(c) Ожидаемый результат.** Карта с визуализацией пространственной неоднородности параметров.

**(iv) Поиск аномальных периодов/событий**
 **(a) Введение.** Продолжительные отклонения могут соответствовать важным климатическим явлениям.
 **(b) Предлагаемый подход.** Найти периоды с большими положительными или отрицательными аномалиями относительно сезонного среднего (`df['var'] - df.groupby('month')['var'].transform('mean')`). Сопоставить переменные между собой в эти периоды.
 **(c) Ожидаемый результат.** Список аномальных эпизодов с указанием времени, величины и задействованных переменных.